

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Build a Docker Container Image &mdash; kiwi 9.6.2 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="kiwi 9.6.2 documentation" href="../index.html"/>
        <link rel="up" title="Building Images" href="../building.html"/>
        <link rel="next" title="Building in a Self-Contained Environment" href="build_containerized.html"/>
        <link rel="prev" title="Setting Up a Network Boot Server" href="build_pxe_root_filesystem/setup_pxe_bootserver.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> kiwi
          

          
            
            <img src="../_static/kiwi-logo.png" class="logo" />
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../overview/legacy_kiwi.html">Legacy KIWI vs. Next Generation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../overview/legacy_kiwi.html#when-do-i-need-to-use-the-legacy-kiwi">When Do I need to use the legacy kiwi</a></li>
<li class="toctree-l3"><a class="reference internal" href="../overview/legacy_kiwi.html#dropped-features">Dropped Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../overview/legacy_kiwi.html#compatibility">Compatibility</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../overview/workflow.html">Basic Workflow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../overview/workflow.html#building-images">Building Images</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../overview/workflow.html#the-prepare-step">The Prepare Step</a></li>
<li class="toctree-l4"><a class="reference internal" href="../overview/workflow.html#the-create-step">The Create Step</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../overview/workflow.html#components-of-an-image-description">Components of an Image Description</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../overview/workflow.html#image-customization-with-config-sh-shell-script">Image Customization with <code class="docutils literal"><span class="pre">config.sh</span></code> Shell Script</a></li>
<li class="toctree-l4"><a class="reference internal" href="../overview/workflow.html#image-customization-with-images-sh-shell-script">Image Customization with <code class="docutils literal"><span class="pre">images.sh</span></code> Shell Script</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../overview/workflow.html#customizing-the-boot-process">Customizing the Boot Process</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../overview/workflow.html#boot-image-hook-scripts">Boot Image Hook-Scripts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../overview/workflow.html#boot-parameters">Boot Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../overview/workflow.html#faq-boot-image-customization">FAQ: Boot Image Customization</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../overview/workflow.html#distribution-specific-code">Distribution Specific Code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#conceptual-overview">Conceptual Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#terminology">Terminology</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#system-requirements">System Requirements</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#example-appliance-descriptions">Example Appliance Descriptions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#before-you-start">Before you start</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#build-your-first-image">Build your first image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#run-your-image">Run your image</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../building.html">Building Images</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="build_live_iso.html">Build an ISO Hybrid Live Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="build_vmx_disk.html">Build a Virtual Disk Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="build_oem_disk.html">Build an OEM Expandable Disk Image</a><ul>
<li class="toctree-l3"><a class="reference internal" href="build_oem_disk.html#deployment-methods">Deployment Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="build_oem_disk.html#manual-deployment">Manual Deployment</a></li>
<li class="toctree-l3"><a class="reference internal" href="build_oem_disk.html#cd-dvd-deployment">CD/DVD Deployment</a></li>
<li class="toctree-l3"><a class="reference internal" href="build_oem_disk.html#network-deployment">Network Deployment</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="build_pxe_root_filesystem.html">Build a PXE root File System Image</a><ul>
<li class="toctree-l3"><a class="reference internal" href="build_pxe_root_filesystem/setup_pxe_bootserver.html">Setting Up a Network Boot Server</a><ul>
<li class="toctree-l4"><a class="reference internal" href="build_pxe_root_filesystem/setup_pxe_bootserver.html#installing-and-configuring-atftp">Installing and Configuring atftp</a></li>
<li class="toctree-l4"><a class="reference internal" href="build_pxe_root_filesystem/setup_pxe_bootserver.html#installing-and-configuring-dhcp">Installing and Configuring DHCP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="build_pxe_root_filesystem.html#pxe-client-configuration">PXE Client Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="build_pxe_root_filesystem.html#setup-client-with-remote-root">Setup client with remote root</a></li>
<li class="toctree-l4"><a class="reference internal" href="build_pxe_root_filesystem.html#setup-client-with-system-on-local-disk">Setup client with system on local disk</a></li>
<li class="toctree-l4"><a class="reference internal" href="build_pxe_root_filesystem.html#setup-client-with-system-on-local-md-raid-disk">Setup client with system on local MD RAID disk</a></li>
<li class="toctree-l4"><a class="reference internal" href="build_pxe_root_filesystem.html#setup-loading-of-custom-configuration-file-s">Setup loading of custom configuration file(s)</a></li>
<li class="toctree-l4"><a class="reference internal" href="build_pxe_root_filesystem.html#setup-client-to-force-reload-image">Setup client to force reload image</a></li>
<li class="toctree-l4"><a class="reference internal" href="build_pxe_root_filesystem.html#setup-client-to-force-reload-configuration-files">Setup client to force reload configuration files</a></li>
<li class="toctree-l4"><a class="reference internal" href="build_pxe_root_filesystem.html#setup-client-for-reboot-after-deployment">Setup client for reboot after deployment</a></li>
<li class="toctree-l4"><a class="reference internal" href="build_pxe_root_filesystem.html#setup-custom-kernel-boot-options">Setup custom kernel boot options</a></li>
<li class="toctree-l4"><a class="reference internal" href="build_pxe_root_filesystem.html#setup-a-custom-boot-timeout">Setup a custom boot timeout</a></li>
<li class="toctree-l4"><a class="reference internal" href="build_pxe_root_filesystem.html#setup-a-different-download-protocol-and-server">Setup a different download protocol and server</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Build a Docker Container Image</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installing-the-requirements">Installing the Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-the-image">Building the Image</a></li>
<li class="toctree-l3"><a class="reference internal" href="#container-configuration">Container Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#map-dockerfile-directives-to-kiwi">Map DockerFile Directives to KIWI</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-an-existing-docker-image-as-base-image">Using an Existing Docker Image as Base Image</a></li>
<li class="toctree-l3"><a class="reference internal" href="#export-image-from-docker-to-be-usable-as-base-image">Export Image from Docker to Be Usable as Base Image</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="build_containerized.html">Building in a Self-Contained Environment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="build_containerized.html#requirements">Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="build_containerized.html#installing-and-setting-up-dice">Installing and Setting up Dice</a></li>
<li class="toctree-l3"><a class="reference internal" href="build_containerized.html#installing-and-setting-up-docker">Installing and Setting up Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="build_containerized.html#installing-and-setting-up-the-build-container">Installing and Setting up the Build Container</a></li>
<li class="toctree-l3"><a class="reference internal" href="build_containerized.html#installing-and-setting-up-vagrant">Installing and Setting up Vagrant</a></li>
<li class="toctree-l3"><a class="reference internal" href="build_containerized.html#configuring-dice">Configuring Dice</a></li>
<li class="toctree-l3"><a class="reference internal" href="build_containerized.html#selecting-a-kiwi-template">Selecting a KIWI Template</a></li>
<li class="toctree-l3"><a class="reference internal" href="build_containerized.html#the-dicefile">The Dicefile</a></li>
<li class="toctree-l3"><a class="reference internal" href="build_containerized.html#building-with-dice">Building with Dice</a></li>
<li class="toctree-l3"><a class="reference internal" href="build_containerized.html#buildsystem-backends">Buildsystem Backends</a></li>
<li class="toctree-l3"><a class="reference internal" href="build_containerized.html#building-with-the-host-buildsystem">Building with the Host Buildsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="build_containerized.html#id1">The Dicefile</a></li>
<li class="toctree-l3"><a class="reference internal" href="build_containerized.html#building-with-the-vagrant-buildsystem">Building with the Vagrant Buildsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="build_containerized.html#id2">The Dicefile</a></li>
<li class="toctree-l3"><a class="reference internal" href="build_containerized.html#the-vagrant-setup-for-the-docker-provider">The Vagrant setup for the Docker Provider</a></li>
<li class="toctree-l3"><a class="reference internal" href="build_containerized.html#the-vagrantfile">The Vagrantfile</a></li>
<li class="toctree-l3"><a class="reference internal" href="build_containerized.html#the-vagrant-setup-for-the-libvirt-provider">The Vagrant setup for the libvirt Provider</a></li>
<li class="toctree-l3"><a class="reference internal" href="build_containerized.html#the-vagrant-build-box">The Vagrant Build Box</a></li>
<li class="toctree-l3"><a class="reference internal" href="build_containerized.html#id3">The Vagrantfile</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="build_in_buildservice.html">Building in the Open Buildservice</a></li>
<li class="toctree-l2"><a class="reference internal" href="working_with_images.html">Working with Images</a><ul>
<li class="toctree-l3"><a class="reference internal" href="working_with_images/iso_to_usb_stick_deployment.html">Deploy ISO Image on an USB Stick</a></li>
<li class="toctree-l3"><a class="reference internal" href="working_with_images/vmx_setup_for_ec2.html">KIWI Image Description for Amazon EC2</a></li>
<li class="toctree-l3"><a class="reference internal" href="working_with_images/vmx_setup_for_azure.html">KIWI Image Description for Microsoft Azure</a></li>
<li class="toctree-l3"><a class="reference internal" href="working_with_images/vmx_setup_for_google.html">KIWI Image Description for Google Compute Engine</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../building.html#supported-distributions">Supported Distributions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../commands.html">KIWI Commands</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../commands/kiwi.html">kiwi</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../commands/kiwi.html#synopsis">SYNOPSIS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/kiwi.html#description">DESCRIPTION</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/kiwi.html#global-options">GLOBAL OPTIONS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/kiwi.html#example">EXAMPLE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/kiwi.html#compatibility">COMPATIBILITY</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../commands/result_list.html">kiwi result list</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../commands/result_list.html#synopsis">SYNOPSIS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/result_list.html#description">DESCRIPTION</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/result_list.html#options">OPTIONS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../commands/result_bundle.html">kiwi result bundle</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../commands/result_bundle.html#synopsis">SYNOPSIS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/result_bundle.html#description">DESCRIPTION</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/result_bundle.html#options">OPTIONS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../commands/system_prepare.html">kiwi system prepare</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../commands/system_prepare.html#synopsis">SYNOPSIS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/system_prepare.html#description">DESCRIPTION</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/system_prepare.html#options">OPTIONS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../commands/system_update.html">kiwi system update</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../commands/system_update.html#synopsis">SYNOPSIS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/system_update.html#description">DESCRIPTION</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/system_update.html#options">OPTIONS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../commands/system_build.html">kiwi system build</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../commands/system_build.html#synopsis">SYNOPSIS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/system_build.html#description">DESCRIPTION</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/system_build.html#options">OPTIONS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/system_build.html#uri-types">URI_TYPES</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../commands/system_create.html">kiwi system create</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../commands/system_create.html#synopsis">SYNOPSIS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/system_create.html#description">DESCRIPTION</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/system_create.html#options">OPTIONS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../commands/image_resize.html">kiwi image resize</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../commands/image_resize.html#synopsis">SYNOPSIS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/image_resize.html#description">DESCRIPTION</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/image_resize.html#options">OPTIONS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../commands/image_info.html">kiwi image info</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../commands/image_info.html#synopsis">SYNOPSIS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/image_info.html#description">DESCRIPTION</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/image_info.html#options">OPTIONS</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../development.html">Development and Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../development/kiwi_from_python.html">Using KIWI NG in a Python Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/api/kiwi.html">API Documentation 9.6.2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#subpackages">Subpackages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../development/api/kiwi.archive.html">kiwi.archive Package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/api/kiwi.boot.html">kiwi.boot Package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/api/kiwi.bootloader.html">kiwi.bootloader Package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/api/kiwi.builder.html">kiwi.builder Package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/api/kiwi.container.html">kiwi.container Package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/api/kiwi.filesystem.html">kiwi.filesystem Package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/api/kiwi.package_manager.html">kiwi.package_manager Package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/api/kiwi.partitioner.html">kiwi.partitioner Package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/api/kiwi.repository.html">kiwi.repository Package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/api/kiwi.storage.html">kiwi.storage Package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/api/kiwi.system.html">kiwi.system Package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/api/kiwi.solver.html">kiwi.solver Package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/api/kiwi.tasks.html">kiwi.tasks package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/api/kiwi.utils.html">kiwi.utils Package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/api/kiwi.volume_manager.html">kiwi.volume_manager Package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#submodules">Submodules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.app"><code class="docutils literal"><span class="pre">kiwi.app</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.cli"><code class="docutils literal"><span class="pre">kiwi.cli</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.command"><code class="docutils literal"><span class="pre">kiwi.command</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.command_process"><code class="docutils literal"><span class="pre">kiwi.command_process</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.defaults"><code class="docutils literal"><span class="pre">kiwi.defaults</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.exceptions"><code class="docutils literal"><span class="pre">kiwi.exceptions</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.firmware"><code class="docutils literal"><span class="pre">kiwi.firmware</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.help"><code class="docutils literal"><span class="pre">kiwi.help</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.iso"><code class="docutils literal"><span class="pre">kiwi.iso</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.kiwi"><code class="docutils literal"><span class="pre">kiwi.kiwi</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.logger"><code class="docutils literal"><span class="pre">kiwi.logger</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.mount_manager"><code class="docutils literal"><span class="pre">kiwi.mount_manager</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.path"><code class="docutils literal"><span class="pre">kiwi.path</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.privileges"><code class="docutils literal"><span class="pre">kiwi.privileges</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.version"><code class="docutils literal"><span class="pre">kiwi.version</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.xml_description"><code class="docutils literal"><span class="pre">kiwi.xml_description</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.xml_state"><code class="docutils literal"><span class="pre">kiwi.xml_state</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi">Module Contents</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../development/schema.html">Schema Documentation 6.5</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../development/schema.html#image">image</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../development/schema.html#description">description</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/schema.html#preferences">preferences</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/schema.html#profiles">profiles</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/schema.html#users">users</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/schema.html#drivers">drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/schema.html#strip">strip</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/schema.html#repository">repository</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/schema.html#packages">packages</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/schema.html#extension">extension</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../development/schema_extensions.html">Extending KIWI with Custom Operations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../development/schema_extensions.html#the-extension-section">The &lt;extension&gt; Section</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/schema_extensions.html#relax-ng-schema-for-the-extension">RELAX NG Schema for the Extension</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/schema_extensions.html#extension-schema-in-xml-catalog">Extension Schema in XML catalog</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/schema_extensions.html#using-the-extension">Using the Extension</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../development.html#fork-the-upstream-kiwi-repository">Fork the upstream KIWI repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development.html#create-a-local-clone-of-the-forked-kiwi-repository">Create a local clone of the forked KIWI repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development.html#create-a-python-virtual-development-environment">Create a python virtual development environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development.html#running-test-cases">Running Test Cases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development.html#create-a-branch-for-each-feature-or-bugfix">Create a branch for each feature or bugfix</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development.html#good-to-know">Good to know</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../development.html#signing-git-patches">Signing Git Patches</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development.html#raising-versions">Raising Versions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development.html#creating-a-package">Creating a Package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development.html#building-documentation">Building Documentation</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">kiwi</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../building.html">Building Images</a> &raquo;</li>
        
      <li>Build a Docker Container Image</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/building/build_docker_container.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="build-a-docker-container-image">
<h1>Build a Docker Container Image<a class="headerlink" href="#build-a-docker-container-image" title="Permalink to this headline">¶</a></h1>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Make sure you have checked out the example image descriptions
For details see <a class="reference internal" href="../installation.html#example-descriptions"><span class="std std-ref">Example Appliance Descriptions</span></a></p>
</div>
<p>The following example shows how to build and run a container image
based on SUSE Leap for the docker container system.</p>
<div class="section" id="installing-the-requirements">
<h2>Installing the Requirements<a class="headerlink" href="#installing-the-requirements" title="Permalink to this headline">¶</a></h2>
<p>Building Docker images with KIWI requires a couple of additional tools.
In practice, <strong class="command">umoci</strong> and <strong class="command">skopeo</strong> utilities are mandatory.
These tools are not yet in all regular openSUSE repositories, however a packaged
version can be found in the <em>Virtualization:containers</em> repository
<a class="reference external" href="http://download.opensuse.org/repositories/Virtualization:/containers/">here</a>.
In order to install them first add the repository using the <strong class="command">zypper ar</strong>
command:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>$ zypper ar -f http://download.opensuse.org/repositories/Virtualization:/containers/&lt;DIST&gt;
</pre></div>
</div>
<p>where the placeholder <code class="xref py py-obj docutils literal"><span class="pre">&lt;DIST&gt;</span></code> is the preferred distribution. Once the
repository has been added install the required utilities:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>$ zypper in umoci skopeo
</pre></div>
</div>
</div>
<div class="section" id="building-the-image">
<h2>Building the Image<a class="headerlink" href="#building-the-image" title="Permalink to this headline">¶</a></h2>
<p>Run the following KIWI command in order to build the base image example.</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>$ sudo kiwi-ng --type docker system build \
    --description kiwi-descriptions/suse/x86_64/suse-leap-42.2-docker \
    --target-dir /tmp/myimage
</pre></div>
</div>
<p>Find the image with the suffix <code class="file docutils literal"><span class="pre">.docker.tar.xz</span></code> below
<code class="file docutils literal"><span class="pre">/tmp/myimage</span></code>. For testing the docker image it’s required
to have the docker subsystem installed and running. The following
command can be used to check if docker is installed and functional
on your system:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>$ docker images
</pre></div>
</div>
<p>The command above lists all available docker images. If the docker
daemon is running and responsive a list output is expected which
could also be empty if no images are available. In any other case
an error message is displayed which needs to be resolved prior to
continue with the next steps.</p>
<p>Once docker works on your system the KIWI built image needs to be
loaded into the docker system with the following command:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>$ docker load -i Docker-Leap-42.2.x86_64-1.0.0.docker.tar.xz
</pre></div>
</div>
<p>On success the docker image is available as part of the images list as follows:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>$ docker images

REPOSITORY          TAG  ...
opensuse            42.2 ...
</pre></div>
</div>
<p>In order to run an interactive shell session of the loaded container
the following command needs to be called:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>$ docker run -it opensuse:42.2 /bin/bash
</pre></div>
</div>
</div>
<div class="section" id="container-configuration">
<h2>Container Configuration<a class="headerlink" href="#container-configuration" title="Permalink to this headline">¶</a></h2>
<p>A docker container includes a set of information also called metadata.
The metadata information is provided within the KIWI XML description
as part of the <code class="docutils literal"><span class="pre">&lt;containerconfig&gt;</span></code> section. The following parameters
can be specified:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">maintainer</span></code>: Specifies the author field of the container.</li>
<li><code class="docutils literal"><span class="pre">cmd</span></code>: Provides the default execution parameters of the container.</li>
<li><code class="docutils literal"><span class="pre">label</span></code>: Adds custom metadata to an image, is key-value pair.</li>
<li><code class="docutils literal"><span class="pre">expose</span></code>: Informs at which ports is the container listening at runtime.</li>
<li><code class="docutils literal"><span class="pre">env</span></code>: Sets an environment value, is key-value pair.</li>
<li><code class="docutils literal"><span class="pre">entrypoint</span></code>: Sets the executable that the container will run, it can
include parameters.</li>
<li><code class="docutils literal"><span class="pre">volume</span></code>: Creates a mountpoint with the given name and marks it to hold
external volumes from the host or from other contianers.</li>
<li><code class="docutils literal"><span class="pre">user</span></code>: Sets the user name or UID to be used when running <code class="xref py py-obj docutils literal"><span class="pre">cmd</span></code> and
<code class="xref py py-obj docutils literal"><span class="pre">entrypoint</span></code>.</li>
<li><code class="docutils literal"><span class="pre">workdir</span></code>: Sets the working directory to be used when running <code class="xref py py-obj docutils literal"><span class="pre">cmd</span></code> and
<code class="xref py py-obj docutils literal"><span class="pre">entrypoint</span></code>.</li>
</ul>
</div>
<div class="section" id="map-dockerfile-directives-to-kiwi">
<h2>Map DockerFile Directives to KIWI<a class="headerlink" href="#map-dockerfile-directives-to-kiwi" title="Permalink to this headline">¶</a></h2>
<p>The native build description in docker is provided by a so called
DockerFile. The DockerFile is a shell like key=value based file.
In addition to the metadata information as shown above other
additional information could be part of a DockerFile. KIWI can
not natively handle the contents of the DockerFile, thus the
following list shows how to map the DockerFile directive in
KIWI:</p>
<ul>
<li><p class="first"><code class="xref py py-obj docutils literal"><span class="pre">ADD</span></code></p>
<p>In order to include a tarball and auto extract it in KIWI it can be done by
including the files in the <a class="reference internal" href="../overview/workflow.html#decription-components"><span class="std std-ref">overlay tree</span></a>,
or by including an <code class="xref py py-obj docutils literal"><span class="pre">&lt;archive&gt;</span></code> item inside the <code class="xref py py-obj docutils literal"><span class="pre">&lt;packages</span> <span class="pre">type=&quot;image&quot;&gt;</span></code>
section. <strong>ADD</strong> also handles remote content, in KIWI this should be done
within the <code class="xref py py-obj docutils literal"><span class="pre">config.sh</span></code> script.</p>
</li>
<li><p class="first"><code class="xref py py-obj docutils literal"><span class="pre">RUN</span></code></p>
<p>In order to execute commands during build time in KIWI it can be done by
extending the <code class="xref py py-obj docutils literal"><span class="pre">config.sh</span></code> script. Note that the <code class="xref py py-obj docutils literal"><span class="pre">config.sh</span></code> is executed
after all the packages have been installed and after the overlay tree has
been applied.</p>
</li>
<li><p class="first"><code class="xref py py-obj docutils literal"><span class="pre">COPY</span></code></p>
<p>The equivalent in KIWI is to make use of the <a class="reference internal" href="../overview/workflow.html#decription-components"><span class="std std-ref">overlay tree</span></a> in order to include files in a specific location.</p>
</li>
</ul>
</div>
<div class="section" id="using-an-existing-docker-image-as-base-image">
<h2>Using an Existing Docker Image as Base Image<a class="headerlink" href="#using-an-existing-docker-image-as-base-image" title="Permalink to this headline">¶</a></h2>
<p>KIWI also supports building of a container image on top of another base image.
In that case, the resulting image will include the base image layers
plus a new one containing the changes added by KIWI. Building derived
images works in the same way as for the base images, the only difference
is that the base image must be specified in the description file, it can
be done using the <strong>derived_from</strong> optional attribute of <code class="docutils literal"><span class="pre">&lt;type&gt;</span></code> tag.
The value of the <strong>derived_from</strong> attribute is the URI of the image;
currently KIWI only supports references to local files (it expects a xz
compressed tarball image) and any other URI type that is supported by
the skopeo tool (for example DockerHub URIs as
<code class="docutils literal"><span class="pre">derived_from=&quot;docker://opensuse:leap&quot;</span></code>). The following example
type specification shows how to specify a base image setup:</p>
<div class="code xml highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nb">type</span> <span class="n">image</span><span class="o">=</span><span class="s2">&quot;docker&quot;</span> <span class="n">derived_from</span><span class="o">=</span><span class="s2">&quot;docker://opensuse:leap&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">containerconfig</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;container_name&quot;</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;container_tag&quot;</span> <span class="n">maintainer</span><span class="o">=</span><span class="s2">&quot;tux&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">entrypoint</span> <span class="n">execute</span><span class="o">=</span><span class="s2">&quot;myscript.sh&quot;</span><span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">subcommand</span> <span class="n">clear</span><span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">containerconfig</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="nb">type</span><span class="o">&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The configuration metadata is inherited from the base image to
the derived one, the only way to change the inherited metadata is by
overwriting it. Only the <code class="docutils literal"><span class="pre">entrypoint</span></code> and <code class="docutils literal"><span class="pre">subcommand</span></code> statements
builds are an exception, they can be wiped using the <code class="docutils literal"><span class="pre">clear</span></code> attribute
as used in the above example.</p>
</div>
</div>
<div class="section" id="export-image-from-docker-to-be-usable-as-base-image">
<h2>Export Image from Docker to Be Usable as Base Image<a class="headerlink" href="#export-image-from-docker-to-be-usable-as-base-image" title="Permalink to this headline">¶</a></h2>
<p>Given there is an image in docker which should be used as a base image
for a KIWI build, we recommend to export the image from docker in the
following way:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ docker save opensuse:42.2 <span class="p">|</span> xz &gt; /tmp/opensuse-42.2.tar.xz
</pre></div>
</div>
<p>Once the command completed the <code class="file docutils literal"><span class="pre">/tmp/opensuse-42.2.tar.xz</span></code> could
be use as base image in the KIWI XML description as follows:</p>
<div class="code xml highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nb">type</span> <span class="n">image</span><span class="o">=</span><span class="s2">&quot;docker&quot;</span> <span class="n">derived_from</span><span class="o">=</span><span class="s2">&quot;file:///tmp/opensuse-42.2.tar.xz&quot;</span><span class="o">&gt;</span>
    <span class="o">...</span>
<span class="o">&lt;/</span><span class="nb">type</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="build_containerized.html" class="btn btn-neutral float-right" title="Building in a Self-Contained Environment" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="build_pxe_root_filesystem/setup_pxe_bootserver.html" class="btn btn-neutral" title="Setting Up a Network Boot Server" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Marcus Schäfer.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'9.6.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>